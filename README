#####################################################################
#
# Demo Name: IoT Demo - DeviceHive, Spark, Cassandra, Kafka
#
# Notes: 
# 
# Maintainer: Samuel Cozannet <samuel.cozannet@canonical.com> 
#
#####################################################################

# Purpose of the demo

DeviceHive makes any connected device part of the Internet of Things. It provides the communication layer, control software and multi-platform libraries to bootstrap development of smart energy, home automation, remote sensing, telemetry, remote control and monitoring software, and much more. Leave communications to DeviceHive and focus on product and innovation. Learn more at: http://devicehive.com

# Main Services deployed
## DeviceHive
### Master


### Workers


## Cassandra Cluster


## Kafka Cluster 


## PostgreSQL


## Redis
 

# Data Sources

Data is taken from Ubuntu Snappy devices sending data back to the DeviceHive API. 


# Usage
## Configuration

Edit ./etc/demo.conf to change: 

* PROJECT_ID : This is the name of your environment
* FACILITY (default to local0): Log facility to use for logging demo activity
* LOGTAG (default to demo): A tag to add to log lines to ease recognition of demos
* MIN_LOG_LEVEL (default to debug): change verbosity. Only logs above this in ./etc/syslog-levels will show up

## Bootstrapping 

	./bin/00-bootstrap.sh

Will set up the environment 

## Deploying  

	./bin/01-deploy-saiku.sh

Will deploy the charms required for the demo

## Configure  

	./bin/10-setup.sh

Will configure whatever needs to be configured

## Resetting 

	./bin/50-reset.sh

Will reset the environment but keep it alive

## Clean

	./bin/99-cleanup.sh

Will completely rip of the environment and delete local files

# Sample Outputs
## Bootstrapping

    :~$ ./bin/00-bootstrap.sh 
    [Tue Sep 1 12:22:16 CEST 2015] [demo] [local0.debug] : Validating dependencies
    [Tue Sep 1 12:22:16 CEST 2015] [demo] [local0.debug] : Successfully switched to dataart
    [Tue Sep 1 12:27:46 CEST 2015] [demo] [local0.debug] : Succesfully bootstrapped dataart
    [Tue Sep 1 12:28:02 CEST 2015] [demo] [local0.debug] : Successfully deployed juju-gui to machine-0
    [Tue Sep 1 12:28:03 CEST 2015] [demo] [local0.info] : Juju GUI now available on https://52.2.244.223 with user admin:5e8490328953c902094c68c16a88226f
    [Tue Sep 1 12:28:24 CEST 2015] [demo] [local0.debug] : Bootstrapping process finished for dataart. You can safely move to deployment.


## Deployment

    $ ./bin/01-deploy-dataart.sh 
    [Mon Sep 7 16:34:47 CEST 2015] [demo] [local0.debug] : Successfully switched to dataart
    [Mon Sep 7 16:35:03 CEST 2015] [demo] [local0.debug] : Successfully deployed devicehive
    [Mon Sep 7 16:35:08 CEST 2015] [demo] [local0.debug] : Successfully set constraints "mem=4G cpu-cores=2 root-disk=32G" for devicehive
    [Mon Sep 7 16:35:24 CEST 2015] [demo] [local0.debug] : Successfully deployed postgresql
    [Mon Sep 7 16:35:28 CEST 2015] [demo] [local0.debug] : Successfully set constraints "mem=2G cpu-cores=2 root-disk=32G" for postgresql
    [Mon Sep 7 16:35:51 CEST 2015] [demo] [local0.debug] : Successfully deployed kafka
    [Mon Sep 7 16:35:55 CEST 2015] [demo] [local0.debug] : Successfully set constraints "mem=4G cpu-cores=2 root-disk=32G" for kafka
    [Mon Sep 7 16:36:20 CEST 2015] [demo] [local0.debug] : Successfully deployed zookeeper
    [Mon Sep 7 16:36:24 CEST 2015] [demo] [local0.debug] : Successfully set constraints "mem=2G cpu-cores=2" for zookeeper
    [Mon Sep 7 16:36:40 CEST 2015] [demo] [local0.debug] : Successfully deployed nginx
    [Mon Sep 7 16:36:44 CEST 2015] [demo] [local0.debug] : Successfully set constraints "mem=2G cpu-cores=2" for nginx
    [Mon Sep 7 16:36:46 CEST 2015] [demo] [local0.debug] : Successfully created relation between zookeeper:ka and kafka:zk
    [Mon Sep 7 16:36:47 CEST 2015] [demo] [local0.crit] : Could not create relation between zookeeper:dh and devicehice:zk
    [Mon Sep 7 16:36:48 CEST 2015] [demo] [local0.debug] : Successfully created relation between kafka:dh and devicehive:ka
    [Mon Sep 7 16:36:52 CEST 2015] [demo] [local0.debug] : Successfully created relation between devicehive:pg and postgresql:dh
    [Mon Sep 7 16:36:53 CEST 2015] [demo] [local0.debug] : Successfully created relation between nginx:dh and devicehive:website
    [Mon Sep 7 16:36:54 CEST 2015] [demo] [local0.debug] : Successfully exposed nginx

 
## Reset

    :~$ ./bin/50-reset.sh 
 

